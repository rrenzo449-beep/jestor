<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Task Manager</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
     body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: radial-gradient(ellipse at bottom, #0d0d2b 0%, #000 100%);
      color: #fff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    /* Orbita y planetas */
    .orbit-container {
      position: absolute;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      z-index: 0;
    }

    .planet-orbit {
      position: absolute;
      top: 50%;
      left: 50%;
      border: 1px dashed rgba(255,255,255,0.1);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      animation: rotate 60s linear infinite;
    }

    .planet {
      position: absolute;
      top: 50%;
      left: 100%;
      width: 20px;
      height: 20px;
      background: #6be6ff;
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }

    .planet:nth-child(2) {
      width: 14px;
      height: 14px;
      background: #ffa07a;
    }

    .planet:nth-child(3) {
      width: 10px;
      height: 10px;
      background: #ffd700;
    }

    .planet-orbit:nth-child(1) {
      width: 200px;
      height: 200px;
      animation-duration: 30s;
    }

    .planet-orbit:nth-child(2) {
      width: 350px;
      height: 350px;
      animation-duration: 45s;
    }

    .planet-orbit:nth-child(3) {
      width: 500px;
      height: 500px;
      animation-duration: 65s;
    }

    @keyframes rotate {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }

    /* Tarjeta principal */
    .card {
      width: 100%;
      max-width: 600px;
      padding: 30px;
      border-radius: 15px;
      background: rgba(255, 255, 255, 0.07);
      box-shadow: 0 8px 20px rgba(0,0,0,0.5);
      backdrop-filter: blur(12px);
      z-index: 1;
    }

    #logout {
      float: right;
      color: #eee;
      text-decoration: none;
      font-weight: 600;
    }
    #logout:hover {
      color: #fff;
    }

    .task-item {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      margin-bottom: 12px;
      padding: 14px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1.1rem;
      color: #fff;
      opacity: 0;
      transform: translateX(-20px);
      animation: fadeInSlide 0.4s forwards;
    }

    .task-item.deleting {
      animation: fadeOutSlide 0.4s forwards;
    }

    .task-item button {
      background-color: #dc3545;
      border: none;
      color: white;
      padding: 6px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }

    .task-item button:hover {
      background-color: #a71d2a;
    }

    @keyframes fadeInSlide {
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes fadeOutSlide {
      to {
        opacity: 0;
        transform: translateX(50px);
        height: 0;
        margin-bottom: 0;
        padding-top: 0;
        padding-bottom: 0;
      }
    }
  </style>
</head>
<body>

  <!-- Orbita animada de planetas -->
  <div class="orbit-container">
    <div class="planet-orbit">
      <div class="planet"></div>
    </div>
    <div class="planet-orbit">
      <div class="planet"></div>
    </div>
    <div class="planet-orbit">
      <div class="planet"></div>
    </div>
  </div>
  
  <div class="card">
    <a href="/logout" id="logout">Logout</a>
    <h2 class="mb-4">Task Manager</h2>

    <div class="input-group mb-3">
      <input id="taskInput" type="text" class="form-control" placeholder="New task..." aria-label="New task" />
      <button id="addBtn" class="btn btn-primary" type="button">Add Task</button>
    </div>

    <ul id="taskList" class="list-unstyled"></ul>
  </div>

  <script>
    const taskList = document.getElementById('taskList');
    const taskInput = document.getElementById('taskInput');
    const addBtn = document.getElementById('addBtn');

    function renderTasks(tasks) {
      taskList.innerHTML = '';
      tasks.forEach((task, idx) => {
        const li = document.createElement('li');
        li.className = 'task-item';
        li.textContent = task;

        const delBtn = document.createElement('button');
        delBtn.textContent = 'Delete';
        delBtn.onclick = () => deleteTaskWithAnimation(li, idx);

        li.appendChild(delBtn);
        taskList.appendChild(li);
      });
    }

    async function fetchTasks() {
      const res = await fetch('/api/tasks');
      if(res.ok){
        const tasks = await res.json();
        renderTasks(tasks);
      } else {
        alert('Error fetching tasks');
      }
    }

    async function addTask() {
      const task = taskInput.value.trim();
      if(!task) return alert('Enter a task');

      const res = await fetch('/api/tasks', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: `task=${encodeURIComponent(task)}`
      });
      if(res.ok){
        taskInput.value = '';
        fetchTasks();
      } else {
        alert('Error adding task');
      }
    }

    function deleteTaskWithAnimation(element, index) {
      element.classList.add('deleting');
      element.style.pointerEvents = 'none'; // para que no se pueda clickear más

      // Espera a que termine la animación para eliminar la tarea del servidor y refrescar
      element.addEventListener('animationend', async () => {
        const res = await fetch(`/api/tasks/${index}`, {
          method: 'DELETE'
        });
        if(res.ok){
          fetchTasks();
        } else {
          alert('Error deleting task');
        }
      }, {once: true});
    }

    addBtn.onclick = addTask;
    window.onload = fetchTasks;
  </script>
</body>
</html>
